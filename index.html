<!DOCTYPE html>
<html>
<head>
  <title>Aplicar Máscara</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>
</head>
<body>
  <h2>Adicione uma máscara à sua foto</h2>
  <input type="file" id="upload" accept="image/*"><br><br>
  <canvas id="canvas" width="600" height="600"></canvas><br>
  <button id="download">Baixar imagem</button>

  <script>
    const canvas = new fabric.Canvas('canvas');
    let mask;

    // Carregar máscara fixa
    fabric.Image.fromURL('mask_open.png', function(img) {
      mask = img;
      mask.selectable = false; // máscara não pode ser movida
      mask.scaleToWidth(canvas.width);
      mask.scaleToHeight(canvas.height);
      canvas.add(mask);
      canvas.sendToBack(mask);
    });

    // Upload da foto
    document.getElementById('upload').onchange = function(e) {
      const reader = new FileReader();
      reader.onload = function(event) {
        fabric.Image.fromURL(event.target.result, function(img) {
          img.set({
            left: 100,
            top: 100,
            selectable: true
          });
          img.scaleToWidth(300); // tamanho inicial
          canvas.add(img);
          canvas.bringToFront(mask); // máscara sempre na frente
        });
      };
      reader.readAsDataURL(e.target.files[0]);
    };

    // Download da imagem final
    document.getElementById('download').onclick = () => {
      const link = document.createElement('a');
      link.download = 'foto_com_mascara.png';
      link.href = canvas.toDataURL();
      link.click();
    };
  </script>
</body>
</html>
